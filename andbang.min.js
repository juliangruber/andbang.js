(function(){function i(){this.callbacks={}}var e=this,t=Array.prototype.slice,n=function(e){return Object.prototype.toString.call(e)=="[object Function]"},r=function(e,t){for(var n in t)e[n]=t[n]};e.io||(e.io=require("socket.io-client")),i.prototype.on=function(e,t,n){var r=arguments.length===3,i=r?arguments[1]:undefined,s=r?arguments[2]:arguments[1];return s._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(s),this},i.prototype.once=function(e,t){function r(){n.off(e,r),t.apply(this,arguments)}var n=this;return this.on(e,r),this},i.prototype.releaseGroup=function(e){var t,n,r,i;for(t in this.callbacks){i=this.callbacks[t];for(n=0,r=i.length;n<r;n++)i[n]._groupName===e&&(i.splice(n,1),n--,r--)}return this},i.prototype.off=function(e,t){var n=this.callbacks[e],r;return n?arguments.length===1?(delete this.callbacks[e],this):(r=n.indexOf(t),n.splice(r,1),this):this},i.prototype.emit=function(e){var t=[].slice.call(arguments,1),n=this.callbacks[e],r=this.getWildcardCallbacks(e),i,s,o;if(n)for(i=0,s=n.length;i<s;++i)n[i].apply(this,t);if(r)for(i=0,s=r.length;i<s;++i)r[i].apply(this,[e].concat(t));return this},i.prototype.getWildcardCallbacks=function(e){var t,n,r=[];for(t in this.callbacks){n=t.split("*");if(t==="*"||n.length===2&&e.slice(0,n[1].length)===n[1])r=r.concat(this.callbacks[t])}return r};var s=function(e){var t=this,n=this.config={url:"https://api.andbang.com:443",transports:["websocket","flashsocket","htmlfile","xhr-multipart","xhr-polling","jsonp-polling"],reconnectAttempts:20,autoConnect:!0,autoSubscribe:!0};r(n,e),i.call(this),n.token&&n.autoConnect&&this.connect()};s.prototype=new i,s.prototype.validateToken=function(e,t){var n=this,r=arguments;this.connected?this.socket.emit("validateSession",e,function(e,r){r?(n.config.autoSubscribe&&n.socket.emit("subscribeTeams"),n.emit("ready",r),t(null,!0)):(n.emit("loginFailed"),t("Could not log in with token"))}):this.connect(function(){n.validateToken.apply(n,r)})},s.prototype.connect=function(t){var n=this,r=["addMember","removeMember","editMember","newTask","deleteTask","editTask","shipTask","startTask","stopTask","laterTask","sortTask","unlaterTask","assignTask","unassignTask","watchTask","unwatchTask","updateTeam","deleteTeam","newProject","chat","directChat","presenceUpdate","notification","clearNotifications"],i=0,s=r.length;this.socket=e.io.connect(this.config.url,{"max reconnection attempts":this.config.reconnectAttempts,transports:this.config.transports,"force new connection":!0}),this.socket.on("connect",function(){n.connected=!0,n.emit("connected"),t&&t()}),this.socket.on("disconnect",function(){n.connected=!1,n.emit("disconnected")}),this.socket.on("reconnect",function(){n.lastEvent&&setTimeout(function(){n.socket.emit("getEventsSinceId",n.lastEvent,function(e,t){var r;e?(n.emit("staleReconnect"),n.disconnect()):(r=JSON.parse(t),r.forEach(function(e){n.emit(e.channel,e)}))})},0)}),this.socket.on("error",function(e){e==="handshake unauthorized"&&n.emit("connectFail"),n.emit("error",e)});for(;i<s;i++)this.socket.on(r[i],function(e){return function(t){t.eventNumber&&(n.lastEvent=t.eventNumber),n.emit(e,t)}}(r[i]))},s.prototype._callApi=function(e,r){var i=t.call(r),s=i[i.length-1],o=n(s)?s:null,u=o?t.call(i,0,i.length-1):i,a=function(e,t,n){if(!o)return;typeof t=="string"?o(e,JSON.parse(t),n):o(e,t,n)};u.length?this.socket.emit(e,u,a):this.socket.emit(e,a)},s.prototype.disconnect=function(){this.socket.disconnect()},s.prototype.getMe=function(e){this._callApi("getMe",arguments)},s.prototype.updateMe=function(e,t){this._callApi("updateMe",arguments)},s.prototype.goOnline=function(e){this._callApi("goOnline",arguments)},s.prototype.goOffline=function(e){this._callApi("goOffline",arguments)},s.prototype.getMyTeams=function(e){this._callApi("getMyTeams",arguments)},s.prototype.getAllMyTeamData=function(e){this._callApi("getAllMyTeamData",arguments)},s.prototype.getMyNotifications=function(e,t){this._callApi("getMyNotifications",arguments)},s.prototype.clearMyNotifications=function(e,t){this._callApi("clearMyNotifications",arguments)},s.prototype.getTask=function(e,t,n){this._callApi("getTask",arguments)},s.prototype.updateTask=function(e,t,n,r){this._callApi("updateTask",arguments)},s.prototype.assignTask=function(e,t,n,r){this._callApi("assignTask",arguments)},s.prototype.unassignTask=function(e,t,n){this._callApi("unassignTask",arguments)},s.prototype.deleteTask=function(e,t,n){this._callApi("deleteTask",arguments)},s.prototype.shipTask=function(e,t,n){this._callApi("shipTask",arguments)},s.prototype.unshipTask=function(e,t,n){this._callApi("unshipTask",arguments)},s.prototype.watchTask=function(e,t,n){this._callApi("watchTask",arguments)},s.prototype.unwatchTask=function(e,t,n){this._callApi("unwatchTask",arguments)},s.prototype.laterTask=function(e,t,n){this._callApi("laterTask",arguments)},s.prototype.unlaterTask=function(e,t,n){this._callApi("unlaterTask",arguments)},s.prototype.startTask=function(e,t,n){this._callApi("startTask",arguments)},s.prototype.stopTask=function(e,t,n){this._callApi("stopTask",arguments)},s.prototype.setTaskPosition=function(e,t,n,r){this._callApi("setTaskPosition",arguments)},s.prototype.createTaskForMe=function(e,t,n){this._callApi("createTaskForMe",arguments)},s.prototype.createTaskForTeammate=function(e,t,n,r){this._callApi("createTaskForTeammate",arguments)},s.prototype.getAllTasks=function(e,t){this._callApi("getAllTasks",arguments)},s.prototype.getMemberTasks=function(e,t,n){this._callApi("getMemberTasks",arguments)},s.prototype.getMemberLateredTasks=function(e,t,n){this._callApi("getMemberLateredTasks",arguments)},s.prototype.getMemberShippedTasks=function(e,t,n){this._callApi("getMemberShippedTasks",arguments)},s.prototype.getMemberWatchedTasks=function(e,t,n){this._callApi("getMemberWatchedTasks",arguments)},s.prototype.getMyTasks=function(e,t){this._callApi("getMyTasks",arguments)},s.prototype.getMyLateredTasks=function(e,t){this._callApi("getMyLateredTasks",arguments)},s.prototype.getMyShippedTasks=function(e,t){this._callApi("getMyShippedTasks",arguments)},s.prototype.getMyWatchedTasks=function(e,t){this._callApi("getMyWatchedTasks",arguments)},s.prototype.createProject=function(e,t,n){this._callApi("createProject",arguments)},s.prototype.updateProject=function(e,t,n,r){this._callApi("updateProject",arguments)},s.prototype.deleteProject=function(e,t,n){this._callApi("deleteProject",arguments)},s.prototype.getProjects=function(e,t){this._callApi("getProjects",arguments)},s.prototype.getProjectTasks=function(e,t,n){this._callApi("getProjectTasks",arguments)},s.prototype.getMember=function(e,t,n){this._callApi("getMember",arguments)},s.prototype.getMembers=function(e,t){this._callApi("getMembers",arguments)},s.prototype.sendChat=function(e,t,n){this._callApi("sendChat",arguments)},s.prototype.sendDirectChat=function(e,t,n,r){this._callApi("sendDirectChat",arguments)},s.prototype.getChatHistory=function(e,t){this._callApi("getChatHistory",arguments)},s.prototype.getDirectChatHistory=function(e,t,n){this._callApi("getDirectChatHistory",arguments)},typeof exports!="undefined"?module.exports=s:e.AndBang=s}).call(this)