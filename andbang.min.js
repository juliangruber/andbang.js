(function(){function t(){this.callbacks={}}var e=this,a=Array.prototype.slice,s=function(t){return"[object Function]"==Object.prototype.toString.call(t)},n=function(t,e){for(var a in e)t[a]=e[a]},i=function(t){var e=[];for(var a in t)e.push(encodeURIComponent(a)+"="+encodeURIComponent(t[a]));return e.join("&")},o=function(t){return/^[\],:{}\s]*$/.test(t.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))};e.io||(e.io=require("socket.io-client")),e.request||(e.request=require("request")),t.prototype.on=function(t){var e=3===arguments.length,a=e?arguments[1]:void 0,s=e?arguments[2]:arguments[1];return s._groupName=a,(this.callbacks[t]=this.callbacks[t]||[]).push(s),this},t.prototype.once=function(t,e){function a(){s.off(t,a),e.apply(this,arguments)}var s=this;return this.on(t,a),this},t.prototype.releaseGroup=function(t){var e,a,s,n;for(e in this.callbacks)for(n=this.callbacks[e],a=0,s=n.length;s>a;a++)n[a]._groupName===t&&(n.splice(a,1),a--,s--);return this},t.prototype.off=function(t,e){var a,s=this.callbacks[t];return s?1===arguments.length?(delete this.callbacks[t],this):(a=s.indexOf(e),s.splice(a,1),this):this},t.prototype.emit=function(t){var e,a,s=[].slice.call(arguments,1),n=this.callbacks[t],i=this.getWildcardCallbacks(t);if(n)for(e=0,a=n.length;a>e;++e)n[e].apply(this,s);if(i)for(e=0,a=i.length;a>e;++e)i[e].apply(this,[t].concat(s));return this},t.prototype.getWildcardCallbacks=function(t){var e,a,s=[];for(e in this.callbacks)a=e.split("*"),("*"===e||2===a.length&&t.slice(0,a[1].length)===a[1])&&(s=s.concat(this.callbacks[e]));return s};var p=function(e){var a=this.config={url:"https://api.andbang.com:443",transports:["websocket","flashsocket","htmlfile","xhr-multipart","xhr-polling","jsonp-polling"],reconnectAttempts:20,autoConnect:!0,autoSubscribe:!0,useREST:!1};n(a,e),t.call(this),a.token&&a.autoConnect&&!a.useREST&&this.validateToken(a.token),a.useREST&&this.saveRestToken(a.url,a.token)};p.prototype=new t,p.prototype.saveRestToken=function(t,e){this.http.url=t,this.http.token=e},p.prototype.validateToken=function(t,e){var a=this,s=arguments,n=e||function(){};this.connected?this.socket.emit("validateSession",t,function(t,e){e?(a.config.autoSubscribe&&a.socket.emit("subscribeTeams"),a.emit("ready",e),n(null,!0)):(a.emit("loginFailed"),n("Could not log in with token"))}):this.connect(function(){a.validateToken.apply(a,s)})},p.prototype.connect=function(t){var a=this,s=["editMember","online","offline","clearNotifications","editTeam","editTask","assignTask","deleteTask","shipTask","unshipTask","watchTask","unwatchTask","laterTask","unlaterTask","startTask","stopTask","sortTask","newTask","interaction","setLastReadNotification","setLastReadTeamChat","setLastReadDirectChat","setDirectChatState","resetLastInteraction","removeMember","notification","addMember","deleteInvite","chat","directChat"],n=0,i=s.length;for(this.socket=e.io.connect(this.config.url,{"max reconnection attempts":this.config.reconnectAttempts,transports:this.config.transports,"force new connection":!0}),this.socket.on("connect",function(){a.connected=!0,a.emit("connected"),t&&t()}),this.socket.on("disconnect",function(){a.connected=!1,a.emit("disconnected")}),this.socket.on("reconnect",function(){a.lastEvent&&setTimeout(function(){a.socket.emit("getEventsSinceId",a.lastEvent,function(t,e){t?(a.emit("staleReconnect"),a.disconnect()):e.forEach(function(t){a.emit(t.channel,t)})})},0)}),this.socket.on("error",function(t){"handshake unauthorized"===t&&a.emit("connectFail"),a.emit("error",t)});i>n;n++)this.socket.on(s[n],function(t){return function(e){e.eventNumber&&(a.lastEvent=e.eventNumber),a.emit(t,e)}}(s[n]))},p.prototype._callApi=function(t,e,n,i){var o=a.call(e),p=o[o.length-1],r=s(p)?p:null,c=r?a.call(o,0,o.length-1):o;i&&c.length!=n&&c.push({});var l=function(t,e,a){r&&("string"==typeof e?r(t,JSON.parse(e),a):r(t,e,a))};c.length?this.socket.emit(t,c,l):this.socket.emit(t,l)},p.prototype.disconnect=function(){this.socket.disconnect()},p.prototype.getMe=function(){this._callApi("getMe",arguments,0,!1)},p.prototype.updateMe=function(){this._callApi("updateMe",arguments,1,!1)},p.prototype.goOnline=function(){this._callApi("goOnline",arguments,0,!1)},p.prototype.goOffline=function(){this._callApi("goOffline",arguments,0,!1)},p.prototype.getMyTeams=function(){this._callApi("getMyTeams",arguments,0,!1)},p.prototype.getAllMyTeamData=function(){this._callApi("getAllMyTeamData",arguments,0,!1)},p.prototype.getMyNotifications=function(){this._callApi("getMyNotifications",arguments,1,!1)},p.prototype.clearMyNotifications=function(){this._callApi("clearMyNotifications",arguments,1,!1)},p.prototype.getTask=function(){this._callApi("getTask",arguments,2,!1)},p.prototype.updateTask=function(){this._callApi("updateTask",arguments,3,!1)},p.prototype.assignTask=function(){this._callApi("assignTask",arguments,3,!1)},p.prototype.deleteTask=function(){this._callApi("deleteTask",arguments,2,!1)},p.prototype.shipTask=function(){this._callApi("shipTask",arguments,2,!1)},p.prototype.unshipTask=function(){this._callApi("unshipTask",arguments,2,!1)},p.prototype.watchTask=function(){this._callApi("watchTask",arguments,2,!1)},p.prototype.unwatchTask=function(){this._callApi("unwatchTask",arguments,2,!1)},p.prototype.laterTask=function(){this._callApi("laterTask",arguments,2,!1)},p.prototype.unlaterTask=function(){this._callApi("unlaterTask",arguments,2,!1)},p.prototype.startTask=function(){this._callApi("startTask",arguments,2,!1)},p.prototype.stopTask=function(){this._callApi("stopTask",arguments,2,!1)},p.prototype.setTaskPosition=function(){this._callApi("setTaskPosition",arguments,3,!1)},p.prototype.createTaskForMe=function(){this._callApi("createTaskForMe",arguments,2,!1)},p.prototype.createTaskForTeammate=function(){this._callApi("createTaskForTeammate",arguments,3,!1)},p.prototype.getAllTasks=function(){this._callApi("getAllTasks",arguments,1,!1)},p.prototype.getTeamShippedTasks=function(){this._callApi("getTeamShippedTasks",arguments,1,!1)},p.prototype.getMemberTasks=function(){this._callApi("getMemberTasks",arguments,2,!1)},p.prototype.getMemberLateredTasks=function(){this._callApi("getMemberLateredTasks",arguments,2,!1)},p.prototype.getMemberShippedTasks=function(){this._callApi("getMemberShippedTasks",arguments,3,!0)},p.prototype.getMemberWatchedTasks=function(){this._callApi("getMemberWatchedTasks",arguments,2,!1)},p.prototype.getMemberActiveTask=function(){this._callApi("getMemberActiveTask",arguments,2,!1)},p.prototype.getMyTasks=function(){this._callApi("getMyTasks",arguments,1,!1)},p.prototype.getMyLateredTasks=function(){this._callApi("getMyLateredTasks",arguments,1,!1)},p.prototype.getMyShippedTasks=function(){this._callApi("getMyShippedTasks",arguments,2,!0)},p.prototype.getMyWatchedTasks=function(){this._callApi("getMyWatchedTasks",arguments,1,!1)},p.prototype.getMyActiveTask=function(){this._callApi("getMyActiveTask",arguments,1,!1)},p.prototype.getTeamActiveTasks=function(){this._callApi("getTeamActiveTasks",arguments,1,!1)},p.prototype.getMember=function(){this._callApi("getMember",arguments,2,!1)},p.prototype.getMembers=function(){this._callApi("getMembers",arguments,1,!1)},p.prototype.setLastReadNotification=function(){this._callApi("setLastReadNotification",arguments,2,!1)},p.prototype.setLastReadTeamChat=function(){this._callApi("setLastReadTeamChat",arguments,2,!1)},p.prototype.setLastReadDirectChat=function(){this._callApi("setLastReadDirectChat",arguments,3,!1)},p.prototype.setDirectChatState=function(){this._callApi("setDirectChatState",arguments,3,!1)},p.prototype.resetLastInteraction=function(){this._callApi("resetLastInteraction",arguments,2,!1)},p.prototype.getInvite=function(){this._callApi("getInvite",arguments,2,!1)},p.prototype.getInvites=function(){this._callApi("getInvites",arguments,1,!1)},p.prototype.sendChat=function(){this._callApi("sendChat",arguments,2,!1)},p.prototype.sendDirectChat=function(){this._callApi("sendDirectChat",arguments,3,!1)},p.prototype.getChatHistory=function(){this._callApi("getChatHistory",arguments,2,!0)},p.prototype.getDirectChatHistory=function(){this._callApi("getDirectChatHistory",arguments,3,!0)},p.prototype.http=function(){},p.prototype.http._callApi=function(t,n,p){var r,c=a.call(p),l=c[c.length-1],u=s(l)?l:null,h=u?a.call(c,0,c.length-1):c,m={},g=t.match(/\{\{[\w_]*\}\}/g)||[];g.length<h.length&&(m=h[h.length-1]);for(var f=function(t,e,a){u&&("string"==typeof a&&o(a)?u(t,JSON.parse(a),e.statusCode):u(t,a,e.statusCode))},d=0,T=g.length;T>d;d++)t=t.replace(g[d],h[d]);n=n.toUpperCase(),r={method:n,headers:{Authorization:"Bearer "+this.token},url:this.url+t,strictSSL:!0},"GET"===n?r.qs=i(m):(r.body=m,r.json=!0),e.request&&e.request(r,f)},p.prototype.http.getMe=function(){this._callApi("/me","GET",arguments)},p.prototype.http.updateMe=function(){this._callApi("/me","PUT",arguments)},p.prototype.http.getMyTeams=function(){this._callApi("/me/teams","GET",arguments)},p.prototype.http.getAllMyTeamData=function(){this._callApi("/me/teamdata","GET",arguments)},p.prototype.http.getMyNotifications=function(){this._callApi("/teams/{{teamId}}/me/notifications","GET",arguments)},p.prototype.http.clearMyNotifications=function(){this._callApi("/teams/{{teamId}}/me/notifications","DELETE",arguments)},p.prototype.http.getTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}","GET",arguments)},p.prototype.http.updateTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}","PUT",arguments)},p.prototype.http.assignTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/assignto/{{userId}}","POST",arguments)},p.prototype.http.deleteTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}","DELETE",arguments)},p.prototype.http.shipTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/ship","POST",arguments)},p.prototype.http.unshipTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/unship","POST",arguments)},p.prototype.http.watchTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/watch","POST",arguments)},p.prototype.http.unwatchTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/unwatch","POST",arguments)},p.prototype.http.laterTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/later","POST",arguments)},p.prototype.http.unlaterTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/now","POST",arguments)},p.prototype.http.startTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/start","POST",arguments)},p.prototype.http.stopTask=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/stop","POST",arguments)},p.prototype.http.setTaskPosition=function(){this._callApi("/teams/{{teamId}}/tasks/{{taskId}}/setposition","POST",arguments)},p.prototype.http.createTaskForMe=function(){this._callApi("/teams/{{teamId}}/me/tasks","POST",arguments)},p.prototype.http.createTaskForTeammate=function(){this._callApi("/teams/{{teamId}}/members/{{userId}}/tasks","POST",arguments)},p.prototype.http.getAllTasks=function(){this._callApi("/teams/{{teamId}}/tasks","GET",arguments)},p.prototype.http.getTeamShippedTasks=function(){this._callApi("/teams/{{teamId}}/tasks/shipped","GET",arguments)},p.prototype.http.getMemberTasks=function(){this._callApi("/teams/{{teamId}}/members/{{userId}}/tasks","GET",arguments)},p.prototype.http.getMemberLateredTasks=function(){this._callApi("/teams/{{teamId}}/members/{{userId}}/latered","GET",arguments)},p.prototype.http.getMemberShippedTasks=function(){this._callApi("/teams/{{teamId}}/members/{{userId}}/shipped","GET",arguments)},p.prototype.http.getMemberWatchedTasks=function(){this._callApi("/teams/{{teamId}}/members/{{userId}}/watched","GET",arguments)},p.prototype.http.getMemberActiveTask=function(){this._callApi("/teams/{{teamId}}/members/{{userId}}/active","GET",arguments)},p.prototype.http.getMyTasks=function(){this._callApi("/teams/{{teamId}}/me/tasks","GET",arguments)},p.prototype.http.getMyLateredTasks=function(){this._callApi("/teams/{{teamId}}/me/latered","GET",arguments)},p.prototype.http.getMyShippedTasks=function(){this._callApi("/teams/{{teamId}}/me/shipped","GET",arguments)},p.prototype.http.getMyWatchedTasks=function(){this._callApi("/teams/{{teamId}}/me/watched","GET",arguments)},p.prototype.http.getMyActiveTask=function(){this._callApi("/teams/{{teamId}}/me/active","GET",arguments)},p.prototype.http.getTeamActiveTasks=function(){this._callApi("/teams/{{teamId}}/active","GET",arguments)},p.prototype.http.getMember=function(){this._callApi("/teams/{{teamID}}/members/{{userId}}","GET",arguments)},p.prototype.http.getMembers=function(){this._callApi("/teams/{{teamId}}/members","GET",arguments)},p.prototype.http.setLastReadNotification=function(){this._callApi("/teams/{{teamId}}/me/notifications/last-read","POST",arguments)},p.prototype.http.setLastReadTeamChat=function(){this._callApi("/teams/{{teamId}}/chats/last-read","POST",arguments)},p.prototype.http.setLastReadDirectChat=function(){this._callApi("/teams/{{teamId}}/chats/{{userId}}/last-read","POST",arguments)},p.prototype.http.setDirectChatState=function(){this._callApi("/teams/{{teamId}}/chats/{{userId}}/state","POST",arguments)},p.prototype.http.resetLastInteraction=function(){this._callApi("/teams/{{teamId}}/members/{{userId}}/reset-last-interaction","POST",arguments)},p.prototype.http.getInvite=function(){this._callApi("/teams/{{teamId}}/invites/{{inviteId}}","GET",arguments)},p.prototype.http.getInvites=function(){this._callApi("/teams/{{teamId}}/invites","GET",arguments)},p.prototype.http.sendChat=function(){this._callApi("/teams/{{teamId}}/chat","POST",arguments)},p.prototype.http.sendDirectChat=function(){this._callApi("/teams/{{teamId}}/chat/{{userId}}","POST",arguments)},p.prototype.http.getChatHistory=function(){this._callApi("/teams/{{teamId}}/chat","GET",arguments)},p.prototype.http.getDirectChatHistory=function(){this._callApi("/teams/{{teamId}}/chat/{{userId}}","GET",arguments)},"undefined"!=typeof exports?module.exports=p:e.AndBang=p}).call(this);