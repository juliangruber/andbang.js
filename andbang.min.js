(function(){function i(){this.callbacks={}}var e=this,t=Array.prototype.slice,n=function(e){return Object.prototype.toString.call(e)=="[object Function]"},r=function(e,t){for(var n in t)e[n]=t[n]};e.io||(e.io=require("socket.io-client")),i.prototype.on=function(e,t){return(this.callbacks[e]=this.callbacks[e]||[]).push(t),this},i.prototype.once=function(e,t){function r(){n.off(e,r),t.apply(this,arguments)}var n=this;return this.on(e,r),this},i.prototype.off=function(e,t){var n=this.callbacks[e],r;return n?1==arguments.length?(delete this.callbacks[e],this):(r=n.indexOf(t),n.splice(r,1),this):this},i.prototype.emit=function(e){var t=[].slice.call(arguments,1),n=this.callbacks[e],r=this.callbacks.all,i,s;if(n)for(i=0,s=n.length;i<s;++i)n[i].apply(this,t);if(r)for(i=0,s=r.length;i<s;++i)r[i].apply(this,[e].concat(t));return this};var s=function(e){var t=this,n=this.config={url:"https://api.andbang.com:443",transports:["websocket","flashsocket","htmlfile","xhr-multipart","xhr-polling","jsonp-polling"],reconnectAttempts:20,autoConnect:!0,autoSubscribe:!0};r(n,e),i.call(this),n.token&&n.autoConnect&&this.connect()};s.prototype=new i,s.prototype.validateToken=function(e,t){var n=this,r=arguments;this.connected?this.socket.emit("validateSession",e,function(e,r){r?(n.config.autoSubscribe&&n.socket.emit("subscribeTeams"),n.emit("ready",r),t(null,!0)):(n.emit("loginFailed"),t("Could not log in with token"))}):this.connect(function(){n.validateToken.apply(n,r)})},s.prototype.connect=function(t){var n=this,r=["addMember","removeMember","editMember","addTask","deleteTask","editTask","shipTask","assignTask","unassignTask","moveTask","favoriteTask","updateTeam","deleteTeam","newProject"],i=0,s=r.length;this.socket=e.io.connect(this.config.url,{"max reconnection attempts":this.config.reconnectAttempts,transports:this.config.transports,"force new connection":!0}),this.socket.on("connect",function(){n.connected=!0,n.emit("connected"),t&&t()}),this.socket.on("disconnect",function(){n.connected=!1,n.emit("disconnected")}),this.socket.on("error",function(e){e==="handshake unauthorized"&&n.emit("connectFail"),n.emit("error",e)});for(;i<s;i++)this.socket.on(r[i],function(e){return function(t){n.emit(e,t)}}(r[i]))},s.prototype._callApi=function(e,r){var i=t.call(r),s=i[i.length-1],o=n(s)?s:null,u=o?t.call(i,0,i.length-1):i,a=function(e,t,n){if(!o)return;typeof t=="string"?o(e,JSON.parse(t),n):o(e,t,n)};u.length?this.socket.emit(e,u,a):this.socket.emit(e,a)},s.prototype.disconnect=function(){this.socket.disconnect()},s.prototype.getMe=function(e){this._callApi("getMe",arguments)},s.prototype.updateMe=function(e,t){this._callApi("updateMe",arguments)},s.prototype.getMyTeams=function(e){this._callApi("getMyTeams",arguments)},s.prototype.getAllMyTeamData=function(e){this._callApi("getAllMyTeamData",arguments)},s.prototype.getTask=function(e,t,n){this._callApi("getTask",arguments)},s.prototype.updateTask=function(e,t,n,r){this._callApi("updateTask",arguments)},s.prototype.assignTask=function(e,t,n,r){this._callApi("assignTask",arguments)},s.prototype.unassignTask=function(e,t,n){this._callApi("unassignTask",arguments)},s.prototype.deleteTask=function(e,t,n){this._callApi("deleteTask",arguments)},s.prototype.shipTask=function(e,t,n){this._callApi("shipTask",arguments)},s.prototype.unshipTask=function(e,t,n){this._callApi("unshipTask",arguments)},s.prototype.watchTask=function(e,t,n){this._callApi("watchTask",arguments)},s.prototype.unwatchTask=function(e,t,n){this._callApi("unwatchTask",arguments)},s.prototype.laterTask=function(e,t,n){this._callApi("laterTask",arguments)},s.prototype.unlaterTask=function(e,t,n){this._callApi("unlaterTask",arguments)},s.prototype.createTaskForMe=function(e,t,n){this._callApi("createTaskForMe",arguments)},s.prototype.createTaskForTeammate=function(e,t,n,r){this._callApi("createTaskForTeammate",arguments)},s.prototype.getAllTasks=function(e,t){this._callApi("getAllTasks",arguments)},s.prototype.getMemberTasks=function(e,t,n){this._callApi("getMemberTasks",arguments)},s.prototype.getMemberLateredTasks=function(e,t,n){this._callApi("getMemberLateredTasks",arguments)},s.prototype.getMemberShippedTasks=function(e,t,n){this._callApi("getMemberShippedTasks",arguments)},s.prototype.getMemberWatchedTasks=function(e,t,n){this._callApi("getMemberWatchedTasks",arguments)},s.prototype.getMemberActiveTask=function(e,t,n){this._callApi("getMemberActiveTask",arguments)},s.prototype.getMyTasks=function(e,t){this._callApi("getMyTasks",arguments)},s.prototype.getMyLateredTasks=function(e,t){this._callApi("getMyLateredTasks",arguments)},s.prototype.getMyShippedTasks=function(e,t,n){this._callApi("getMyShippedTasks",arguments)},s.prototype.getMyWatchedTasks=function(e,t){this._callApi("getMyWatchedTasks",arguments)},s.prototype.getMyActiveTask=function(e,t){this._callApi("getMyActiveTask",arguments)},s.prototype.createProject=function(e,t,n){this._callApi("createProject",arguments)},s.prototype.updateProject=function(e,t,n,r){this._callApi("updateProject",arguments)},s.prototype.deleteProject=function(e,t,n){this._callApi("deleteProject",arguments)},s.prototype.getProjects=function(e,t){this._callApi("getProjects",arguments)},s.prototype.getProjectTasks=function(e,t,n){this._callApi("getProjectTasks",arguments)},s.prototype.getMember=function(e,t,n){this._callApi("getMember",arguments)},s.prototype.getMembers=function(e,t){this._callApi("getMembers",arguments)},s.prototype.getInvite=function(e,t,n){this._callApi("getInvite",arguments)},s.prototype.getInvites=function(e,t){this._callApi("getInvites",arguments)},s.prototype.createInvite=function(e,t,n){this._callApi("createInvite",arguments)},s.prototype.resendInvite=function(e,t,n){this._callApi("resendInvite",arguments)},s.prototype.acceptInvite=function(e,t,n){this._callApi("acceptInvite",arguments)},s.prototype.deleteInvite=function(e,t,n){this._callApi("deleteInvite",arguments)},typeof exports!="undefined"?module.exports=s:e.AndBang=s}).call(this)